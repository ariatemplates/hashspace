!function(a){a("hsp/json.js",[],function(a){function b(a,b,c,d,e){return{type:e,object:a,name:b,newValue:c,oldValue:d}}function c(a,b){var c=a[f];if(c)for(var d,e=0,g=c.length;g>e;e++)d=c[e],d.constructor===Function&&d(b)}function d(a,b,c){"object"==typeof a&&(a[c]||(a[c]=[]),a[c].push(b))}function e(a,b,c){if("object"==typeof a){var d=a[c];if(d){for(var e,f=[],g=0,h=d.length;h>g;g++)e=d[g],e!==b&&f.push(e);0===f.length?delete a[c]:a[c]=f}}}var f=(a.require,a.exports,a.filename,a.dirname,"+json:observers"),g=Array.prototype,h=g.splice,i=g.push,j=g.shift,k=g.pop,l=g.reverse,m=g.sort,n=g.unshift;Array.prototype.splice=function(a){if(this[f]){var d=this.length,e=h.apply(this,arguments),g=this.length,i=[b(this,a,null,null,"splice")];return d!==g&&i.push(b(this,"length",g,d,"updated")),c(this,i),e}return h.apply(this,arguments)},Array.prototype.splice2=function(a,d,e){var g=this.length;e||(e=[]),e.splice(0,0,a,d);var i=h.apply(this,e);if(this[f]){var j=this.length,k=[b(this,a,null,null,"splice")];g!==j&&k.push(b(this,"length",j,g,"updated")),c(this,k)}return i},Array.prototype.push=function(){if(this[f]){var a,d,e=arguments,g=e.length,h=this.length,j=[];if(1>g)return h;if(1==g)d=i.call(this,e[0]),j.push(b(this,h,e[0],null,"new"));else{for(var k=0;g>k;k++)a=e[k],j[g-k-1]={type:"new",object:this,name:h+k,newValue:a};d=i.apply(this,e)}return h!==d&&j.push(b(this,"length",d,h,"updated")),c(this,j),d}return i.apply(this,arguments)},Array.prototype.shift=function(){if(this[f]){var a=this.length,d=j.call(this),e=this.length,g=[b(this,0,null,null,"shift")];return a!==e&&g.push(b(this,"length",e,a,"updated")),c(this,g),d}return j.call(this)},Array.prototype.unshift=function(){if(this[f]){var a=this.length;n.apply(this,arguments);var d=this.length,e=[b(this,0,null,null,"unshift")];return a!==d&&e.push(b(this,"length",d,a,"updated")),c(this,e),d}return n.apply(this,arguments)},Array.prototype.pop=function(){if(this[f]){var a=this.length,d=k.call(this),e=this.length,g=[b(this,0,null,null,"pop")];return a!==e&&g.push(b(this,"length",e,a,"updated")),c(this,g),d}return k.call(this)},Array.prototype.reverse=function(){var a=l.call(this);return c(this,[b(this,0,null,null,"reverse")]),a},Array.prototype.sort=function(a){var d;return d=a?m.call(this,a):m.call(this),c(this,[b(this,0,null,null,"sort")]),d};var o=Object.prototype.hasOwnProperty;a.exports={MD_OBSERVERS:f,$set:function(a,d,e){if(a[f]){var g=o.call(a,d),h=a[d],i=a.length,j=null;if(a[d]=e,g?h!==e&&(j=[b(a,d,e,h,"updated")]):j=[b(a,d,e,h,"new")],a.constructor===Array){var k=a.length;i!==k&&(j||(j=[]),j.push(b(a,"length",k,i,"updated")))}j&&c(a,j)}else a[d]=e;return e},$delete:function(a,d){if(a[f]){var e=o.call(a,d),g=a[d];if(delete a[d],e){var h=[b(a,d,a[d],g,"deleted")];c(a,h)}}else delete a[d]},observe:function(a,b){d(a,b,f)},unobserve:function(a,b){e(a,b,f)}},a.exports.set=a.exports.$set}),a("hsp/$set.js",["./json"],function(a){function b(a){if(!g.test(a))throw new Error("Invalid operator: "+a);return f[a]=Function("a","b","a"+a+"b;return a;")}var c=a.require,d=(a.exports,a.filename,a.dirname,c("./json")),e=a.exports=function(a,b,c){return d.$set(a,b,c)};e.del=d.$delete;var f={},g=/^([-+*%\/&^|]|<<|>>|>>>)?=$/;e.op=function(a,c,d,g){var h=f[d]||b(d);return e(a,c,h(a[c],g))},e.inc=function(a,b){var c=a[b];return e(a,b,c+1),c},e.dec=function(a,b){var c=a[b];return e(a,b,c-1),c}}),a("hsp/es5.js",[],function(a){a.require,a.exports,a.filename,a.dirname;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");return a.prototype=b,new a}}()}),a("hsp/klass.js",[],function(a){function b(){return d++,"+"+d+":"}var c=(a.require,a.exports,a.filename,a.dirname,function(a){var b=a.$constructor;if(!b){var c=a.$extends;b=c?function(){c.apply(this,arguments)}:new Function,a.$constructor=b}if(a.$extends){if(!a.$extends.prototype)throw new Error("[klass] $extends attribute must be a function");var d=Object.create(a.$extends.prototype);for(var e in a)a.hasOwnProperty(e)&&(d[e]=b[e]=a[e]);b.prototype=d}else{b.prototype=a;for(var e in a)a.hasOwnProperty(e)&&(b[e]=a[e])}return b}),d=0;c.createMetaDataPrefix=b,a.exports=c}),a("hsp/propobserver.js",["./klass","./json"],function(a){function b(a){for(var b,d=0,e=a.length;e>d;d++)b=a[d],b&&this.props[b.name]&&c(this,b,b.name);this.props[g]&&c(this,b,g)}function c(a,b,c){for(var d=a.props[c],e=0,f=d.length;f>e;e++)d[e].onPropChange(b)}var d=a.require,e=(a.exports,a.filename,a.dirname,d("./klass")),f=d("./json"),g="**ALL**",h=e({$constructor:function(a){this.id=0,this.target=a,this.props={};var c=this;this.callback=function(a){b.call(c,a)},f.observe(a,this.callback)},$dispose:function(){f.unobserve(this.target,this.callback),this.props=null,this.callback=null,this.target=null},addObserver:function(a,b){b||(b=g);var c=this.props[b];c||(c=[],this.props[b]=c),c.push(a)},rmObserver:function(a,b){b||(b=g);var c=this.props[b];if(c){for(var d=0,e=c.length;e>d;d++)c[d]===a&&(c.splice(d,1),e-=1,d-=1);0===c.length&&(this.props[b]=null)}}});a.exports=h}),a("hsp/rt/log.js",[],function(a){function b(a){if(!a||!a.length)return{items:[],metaData:{}};for(var b,c=[],d={},e=0,f=a.length;f>e;e++)b=a[e],e>0&&e===f-1?"object"==typeof b&&b.type&&"string"==typeof b.type&&h[b.type]?d=b:c[e]=b:c[e]=b;return{items:c,metaData:d}}function c(a,c,e){var h,c=b(c),i=c.items,j=c.metaData,k=i.length;if((e||!j.type)&&(j.type=a),0===k)j.message="";else if(1===k)j.message=f(i[0]);else{for(var l=[],m=0;k>m;m++)h=f(i[m]),""!==h&&l.push(h);j.message=l.join(" ")}if(g&&g.length)for(var n=!1,m=0,k=g.length;k>m&&!(n=!g[m](j));m++);else d(j)}function d(a){var b={info:"info",error:"error",warning:"warn",debug:"log"};void 0!==typeof console&&console[b[a.type]](i.format(a))}function e(a,b){return a>b?1:b>a?-1:0}function f(a,b){(void 0===b||null===b)&&(b=1);var c,d=typeof a;if(null===a)return"null";if(void 0===a)return"undefined";if("object"===d){if(b>0){var g=[];if(a.constructor===Array){for(var h=0,i=a.length;i>h;h++)c=a[h],g.push("string"==typeof c?h+':"'+f(c,b-1)+'"':h+":"+f(c,b-1));return"["+g.join(", ")+"]"}var j=[];for(var k in a)k.match(/^\+/)||j.push(k);j.sort(e);for(var h=0,i=j.length;i>h;h++)c=a[j[h]],g.push("string"==typeof c?j[h]+':"'+f(c,b-1)+'"':j[h]+":"+f(c,b-1));return"{"+g.join(", ")+"}"}return a.constructor===Array?"Array["+a.length+"]":a.constructor===Function?"Function":"Object"}return"function"===d?"Function":""+a}var g=(a.require,a.exports,a.filename,a.dirname,[]),h={debug:!0,error:!0,warning:!0,info:!0},i=function(){c("debug",arguments,!1)};i.addLogger=function(a){a&&g.unshift(a)},i.removeLogger=function(a){if(g&&g.length)for(var b=0,c=g.length;c>b;b++)g[b]===a&&(g.splice(b,1),c-=1,b-=1)},i.removeAllLoggers=function(){g=[]},i.getNbrOfLoggers=function(){return g.length},i.error=function(){c("error",arguments,!0)},i.warning=function(){c("warning",arguments,!0)},i.info=function(){c("info",arguments,!0)},i.format=function(a){var b=[];return b.splice(b.length,0,"[",a.type),a.file&&b.splice(b.length,0,": ",a.file),b.splice(b.length,0,"] ",a.message),(a.line||a.column)&&(b.splice(b.length,0," ("),a.line&&b.splice(b.length,0,"line:",a.line),a.column&&(a.line?b.splice(b.length,0,", column:",a.column):b.splice(b.length,0,"column:",a.column)),b.splice(b.length,0,")")),a.code&&b.splice(b.length,0,"\r\n>> ",a.code),b.join("")},a.exports=i}),a("hsp/rt/document.js",[],function(a){var b=(a.require,a.exports,a.filename,a.dirname,window.document);a.exports.createDocumentFragment=function(){return b.createDocumentFragment()},a.exports.createElement=function(a){return b.createElement(a)},a.exports.createElementNS=function(a,c){return b.createElementNS(a,c)},a.exports.createTextNode=function(a){return b.createTextNode(a)},a.exports.createComment=function(a){return b.createComment(a)},a.exports.getElementById=function(a){return b.getElementById(a)},b.createEvent&&(a.exports.createEvent=function(){return b.createEvent.apply(b,arguments)}),b.createEventObject&&(a.exports.createEventObject=function(){return b.createEventObject.apply(b,arguments)})}),a("hsp/expressions/lexer.js",[],function(a){function b(a){return"	"===a||"\r"===a||"\n"===a||" "===a}function c(a){return'"'===a||"'"===a}function d(a){return a>="0"&&"9">=a}function e(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||"$"===a||"_"===a}function f(a){return e(a)||d(a)}function g(a){return"+-*/%!|&.,=<>()[]{}?:".indexOf(a)>-1}function h(a,b){var c=i[a];return c&&c.indexOf(b)>-1}var i=(a.require,a.exports,a.filename,a.dirname,{"|":"|","&":"&","=":"=<>!"});a.exports=function(a){var i,j,k,l,m,n=String.fromCharCode(0),o=[],p=0;if("string"==typeof a)for(i=a+n,j=i.charAt(0);j!==n;)if(l=p,m="",b(j))j=i.charAt(++p);else if(g(j)){do m+=j,j=i.charAt(++p);while(h(j,m.charAt(m.length-1)));o.push({t:"opr",v:m,f:l})}else if(e(j)){do m+=j,j=i.charAt(++p);while(f(j));o.push({t:"idn",v:m,f:l})}else if(c(j)){for(k=j,j=i.charAt(++p);j!==k&&j!==n;)"\\"===j&&i.charAt(p+1)===k?(m+=k,j=i.charAt(++p)):m+=j,j=i.charAt(++p);if(!c(j))throw new Error('Error parsing "'+a+'": unfinished string at '+l);o.push({t:"str",v:m,f:l}),j=i.charAt(++p)}else{if(!d(j))throw new Error('Error parsing "'+a+'": unknown token '+j+" at "+l);do m+=j,j=i.charAt(++p);while(d(j)||"."===j);o.push({t:"num",v:m.indexOf(".")>-1?parseFloat(m):parseInt(m),f:l})}return o}}),a("hsp/expressions/parser.js",["./lexer"],function(a){function b(){return this}function c(a,b){var c=m[a];return b=b||0,c?b>=c.lbp&&(c.lbp=b):(c=Object.create(o),c.id=c.v=a,c.lbp=b,m[a]=c),c}function d(a,b){var d=c(a);return d.nud=b||function(){return this.l=h(70),this.a="unr",this},d}function e(a,b,d){var e=c(a,b);return e.led=d||function(a){return this.l=a,this.r=h(b),this.a="bnr",this},e}function f(a,b,d){var e=c(a,b);return e.led=d||function(a){return this.l=a,this.r=h(b-1),this.a="bnr",this},e}function g(a){var b,c,d,e;if(a&&j.id!==a)throw new Error("Expected '"+a+"' but '"+j.id+"' found.");if(n>=i.length)return void(j=m["(end)"]);if(d=i[n],n+=1,e=d.v,b=d.t,"idn"===b)c=m[e]||m["(identifier)"];else if("opr"===b){if(c=m[e],!c)throw new Error("Unknown operator: "+e)}else{if("str"!==b&&"num"!==b)throw new Error("Unexpected token:"+e);c=m["(literal)"],b="literal"}return j=Object.create(c),j.v=e,j.a=b,j}function h(a){var b,c=j;for(g(),b=c.nud();a<j.lbp;)c=j,g(),b=c.led(b);return b}var i,j,k=a.require,l=(a.exports,a.filename,a.dirname,k("./lexer")),m={},n=0,o={nud:function(){throw new Error("Invalid expression - missing operand for the "+this.v+" operator")},led:function(){throw new Error("Missing operator: "+this.v)}},p=function(a,b){var d=c(a);return d.nud=function(){return this.v=m[this.id].v,this.a="literal",this},d.v=b,d};c("(end)"),c("(identifier)").nud=b,c("(literal)").nud=b,c("]"),c(")"),c("}"),c(","),c(":"),p("true",!0),p("false",!1),p("null",null),d("new",function(){var a=[];if(this.a="bnr",this.l=h(70),g("("),")"!==j.v)for(;;){if(a.push(h(0)),","!==j.id)break;g(",")}return g(")"),this.r=a,this}),d("-"),d("!"),d("(",function(){var a=h(0);return g(")"),a}),d("[",function(){var a=[];if("]"!==j.id)for(;;){if(a.push(h(0)),","!==j.id)break;g(",")}return g("]"),this.l=a,this.a="unr",this}),d("{",function(){var a=[];if("}"!==j.id)for(;;){var b=j;if("idn"!==b.a&&"literal"!==b.a)throw new Error("Bad key.");g(),g(":");var c=h(0);if(c.key=b.v,a.push(c),","!==j.id)break;g(",")}return g("}"),this.l=a,this.a="unr",this}),f("=",10,function(a){if("idn"===a.a)this.l=a,this.l.a="literal",this.r=h(9),this.a="bnr";else{if("."!==a.id&&"["!==a.id)throw new Error("Invalid left-hand side in assignment: "+a.id);this.l=a.l,this.r=a.r,this.othr=h(9),this.a="tnr"}return this}),e("?",20,function(a){return this.l=a,this.r=h(0),g(":"),this.othr=h(0),this.a="tnr",this}),f("&&",30),f("||",30),f("<",40),f(">",40),f("<=",40),f(">=",40),f("==",40),f("!=",40),f("===",40),f("!==",40),e("+",50),e("-",50),e("*",60),e("/",60),e("%",60),e(".",80,function(a){if(this.l=a,"idn"!==j.a)throw new Error("Expected a property name, got:"+j.a+" at "+j.f);return j.a="literal",this.r=j,this.a="bnr",g(),this}),e("[",80,function(a){return this.l=a,this.r=h(0),this.a="bnr",g("]"),this}),e("(",70,function(a){var b=[];if("."===a.id||"["===a.id)this.a="tnr",this.l=a.l,this.r=a.r,this.othr=b;else if(this.a="bnr",this.l=a,this.r=b,"unr"!==a.a&&"idn"!==a.a&&"("!==a.id&&"&&"!==a.id&&"||"!==a.id&&"?"!==a.id)throw new Error("Expected a variable name: "+JSON.stringify(a));if(")"!==j.id)for(;;){if(b.push(h(0)),","!==j.id)break;g(",")}return g(")"),this}),f("|",20,function(a){for(this.l=a,this.r=h(20),this.a="tnr",this.othr=[];"opr"===j.a&&":"===j.v;)g(),this.othr.push(h(20));return this}),a.exports=function(a){var b,c,d=[];if(i=l(a),j=void 0,n=0,i.length){for(g();"(end)"!==j.id;)b=h(0),d.push(b),c=j,","===j.v&&g(",");if(","===c.v)throw new Error("Statement separator , can't be placed at the end of an expression");return 1===d.length?d[0]:d}return{f:0,a:"literal",v:void 0}}}),a("hsp/expressions/evaluator.js",[],function(a){function b(a,b,c){return"undefined"==typeof b||null===b?void 0:b[c]}var c=(a.require,a.exports,a.filename,a.dirname,{"!":function(a,b){return!b},"-":function(a,b){return-b},"[":function(a,b){return b},"{":function(a,b){for(var c,d={},e=0;e<b.length;e++)c=b[e],d[c.k]=c.v;return d}}),d={"+":function(a,b,c){return b+c},"-":function(a,b,c){return b-c},"*":function(a,b,c){return b*c},"/":function(a,b,c){return b/c},"%":function(a,b,c){return b%c},"<":function(a,b,c){return c>b},">":function(a,b,c){return b>c},">=":function(a,b,c){return b>=c},"<=":function(a,b,c){return c>=b},"==":function(a,b,c){return b==c},"!=":function(a,b,c){return b!=c},"===":function(a,b,c){return b===c},"!==":function(a,b,c){return b!==c},"||":function(a,b,c){return b||c},"&&":function(a,b,c){return b&&c},"(":function(a,b,c){return b.apply(b,c)},"new":function(a,b,c){var d=Object.create(b.prototype);return Function.prototype.apply.call(b,d,c),d},".":b,"[":b,"=":function(a,b,c){return a[b]=c}},e={"(":function(a,b,c,d){return"undefined"==typeof b||null===b?void 0:b[c].apply(b,d)},"?":function(a,b,c,d){return b?c:d},"|":function(a,b,c,d,e){var f="function"==typeof c?c:c.apply;if(f)return f.apply("function"==typeof c?e:c,[b].concat(d));throw new Error("Pipe expression is neither a function nor an object with the apply() method")},"=":function(a,b,c,d){return b[c]=d}};a.exports=function f(a,b){var g,h,i,j,k,l={};if(a instanceof Array){if(a.length>0){h=new Array(a.length);for(var m=0;m<a.length;m++)j=a[m],k=i=f(j,b),j.key&&(k={k:j.key,v:i}),h[m]=k}else h=[];return h}if("literal"===a.a)h=a.v;else if("idn"===a.a)h=b[a.v];else if("unr"===a.a&&c[a.v])g=c[a.v],h=g(b,f(a.l,b));else if("bnr"===a.a&&d[a.v])g=d[a.v],h=g(b,f(a.l,b),f(a.r,b));else{if("tnr"!==a.a||!e[a.v])throw new Error('Unknown tree entry of type "'+a.a+" and value "+a.v+" in:"+JSON.stringify(a));g=e[a.v],h="|"!==a.v||"."!==a.r.v&&"["!==a.r.v?g(b,f(a.l,b),f(a.r,b),f(a.othr,b),l):g(b,f(a.l,b),f(a.r,b),f(a.othr,b),f(a.r.l,b))}return h}}),a("hsp/expressions/observable.js",["./evaluator"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("./evaluator")),d=function(a,b){var d=c(a,b);if(null==d)throw new Error(a.v+" is not defined");return d};a.exports=function e(a,b){var f,g,h;if(a instanceof Array){if(f=[],a.length>0)for(var i=0;i<a.length;i++)f=f.concat(e(a[i],b));return f}if("literal"===a.a)return[];if("idn"===a.a)return b[a.v]&&b[a.v]instanceof Array?[[b,a.v],[b[a.v],null]]:[[b,a.v]];if("unr"===a.a)return e(a.l,b);if("bnr"===a.a)return f=e(a.l,b),"."===a.v?(g=c(a.l,b),g?(f=f.concat([[g,a.r.v]]),g[a.r.v]instanceof Array?f.concat([[g[a.r.v],null]]):f):f):"("===a.v?[[b,null]].concat(e(a.r,b)):"["===a.v?(g=c(a.l,b),g&&(h=c(a.r,b),f=f.concat([[g,h]]),g[h]instanceof Array&&(f=f.concat([[g[h],null]]))),f.concat(e(a.r,b))):f.concat(e(a.r,b));if("tnr"===a.a){if(f=e(a.l,b),"("===a.v)f=f.concat([[d(a.l,b),null]]);else if("|"===a.v){f=f.concat(e(a.r,b));var j="."===a.r.v?a.r.l:a.r;f=f.concat([[d(j,b),null]])}else f=f.concat(e(a.r,b));return f.concat(e(a.othr,b))}throw new Error("unknown entry"+JSON.stringify(a))}}),a("hsp/expressions/manipulator.js",["./parser","./evaluator","../json"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("./parser")),d=b("./evaluator"),e=b("../json");a.exports=function(a,b){var f=b||c(a),g="idn"===f.a||"bnr"===f.a&&("."===f.v||"["===f.v);return{getValue:function(a,b){var c=d(f,a);return"undefined"==typeof b?c:void 0===c||null===c||c!=c?b:c},setValue:function(b,c){if(!g)throw new Error('Expression "'+a+'" is not assignable');"idn"===f.a?e.set(b,f.v,c):"bnr"===f.a&&e.set(d(f.l,b),d(f.r,b),c)},isAssignable:g,isMultiStatement:f instanceof Array}}}),a("hsp/rt/exphandler.js",["../klass","./log","../expressions/parser","../expressions/observable","../expressions/manipulator"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("./log"),e=b("../expressions/parser"),f=b("../expressions/observable"),g=b("../expressions/manipulator"),h=c({$constructor:function(a,b){this.observeTarget=b===!0,this.exps={};var c;for(var e in a)c=a[e],c.constructor===Array?this.exps[e]=new i(c,this):d.warning("Unsupported expression definition: "+c)},getValue:function(a,b,c){return this.exps["e"+a].getValue(b,this,c)},getExpr:function(a){return this.exps["e"+a]},getScopeOwner:function(a,b){for(var c=b;c;){if(c.hasOwnProperty(a))return c;c=c["+parent"]}return null},createSubScope:function(a){var b=Object.create(a);return b.scope=b,b["+parent"]=a,b}});a.exports=h;var i=c({$constructor:function(a){this.exptext=a[1],this.ast=e(a[1]),this.bound=a.length>2?a[2]:!0,this.manipulator=g(a[1],this.ast),this.isMultiStatement=this.manipulator.isMultiStatement},getValue:function(a,b,c){try{return this.manipulator.getValue(a,c)}catch(e){d.warning("Error evaluating expression '"+this.exptext+"': "+e.message)}},setValue:function(a,b){this.manipulator.isAssignable?this.manipulator.setValue(a,b):d.warning(this.exptext+" can't be updated - please use object references")},executeCb:function(a,b,c){var d=Object.create(c);return d.event=a,this.getValue(d,b)},getObservablePairs:function(a,b){try{return this.bound?f(this.ast,b):null}catch(c){d.warning("Error evaluating expression '"+this.exptext+"': "+c.message)}}})}),a("hsp/rt/tnode.js",["../rt","../klass","./log","./exphandler"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../rt")),d=b("../klass"),e=b("./log"),f=b("./exphandler"),g=d({node:null,vscope:null,root:null,parent:null,children:null,childNodes:null,adirty:!1,cdirty:!1,edirty:!1,htmlCbs:null,nodeNS:null,isCptContent:!1,obsPairs:null,needSubScope:!1,$constructor:function(a,b){this.isStatic=0===a,this.isStatic||(this.eh=new f(a,b))},$dispose:function(){var a=this.childNodes;if(a){for(var b=0,c=a.length;c>b;b++)a[b].$dispose();delete this.childNodes}this.root&&this.root.rmAllObjectObservers(this),this.obsPairs=null,this.htmlCbs=null,this.node=null,this.parent=null,this.root=null,this.vscope=null,this.atts=null,this.evtHandlers=null},createAttList:function(a,b){if(b){var c,d=[];for(var f in b)c=new j(f,b[f]),c.isHtmlCallback&&(this.htmlCbs||(this.htmlCbs=[]),this.htmlCbs.push(c)),d.push(c);this.evtHandlers=d}if(null===a||0===a)return null;var g,k=[];for(var f in a)a.hasOwnProperty(f)&&(g=a[f],null===g?k.push(new h(f,f)):"string"==typeof g?k.push(new h(f,g)):g.constructor===Array?k.push(new i(f,g)):e.error("[TNode] unsupported attribute: "+g));this.atts=k},onPropChange:function(){var a=this.root;this.adirty||(this.isCptComponent&&this.ctlWrapper&&this.refreshAttributes(),this.adirty=!0,this===a&&c.refresh.addTemplate(this)),this.isCptContent&&(this.parent.edirty=!0);for(var b=this.parent;b;)b.isCptContent&&b.parent&&(b.parent.edirty=!0),b.cdirty?b=null:(b.cdirty=!0,b===a&&c.refresh.addTemplate(b),b=b.parent)},createNodeInstance:function(a){var b=Object.create(this);if(b.parent=a,b.vscope=this.needSubScope?b.createSubScope():a.vscope,b.nodeNS=a.nodeNS,b.root=a.root,b.root.createExpressionObservers(b),this.isDOMless)b.node=b.parent.node;else if(b.createNode(),b.parent.node&&b.parent.node.appendChild(b.node),this.children){b.childNodes=[];for(var c=0,d=this.children.length;d>c;c++)b.childNodes[c]=this.children[c].createNodeInstance(b)}return b},refresh:function(){if(this.adirty&&(this.root.updateObjectObservers(this),this.adirty=!1),this.cdirty){var a=this.childNodes;if(a)for(var b=0,c=a.length;c>b;b++)a[b].refresh();this.cdirty=!1}},createNode:function(){},replaceNodeBy:function(a,b){if(a!==b&&this.node===a){this.node=b;var c=this.childNodes;if(c)for(var d=0,e=c.length;e>d;d++)c[d].replaceNodeBy(a,b)}},registerAttElements:function(a){var b,c=this.childNodes;if(c)for(var d=0,f=c.length;f>d;d++)b=c[d],b.registerAttElements?b.registerAttElements(a):b.isEmptyTextNode||e.error(this+" Statement must not produce invalid attribute elements when used as component content")},removeChildNodeInstances:function(a,b){var c=this.childNodes;if(c){for(var d=0,e=c.length;e>d;d++)c[d].$dispose();delete this.childNodes}this.childNodes=null;for(var f,g=this.node,h=!1,i=a,j=b,d=g.childNodes.length-1;d>-1;d--)if(f=g.childNodes[d],h){if(f===i){d=-1;break}g.removeChild(f)}else f===j&&(h=!0)},createSubScope:function(a){return a||(a=this.parent.vscope),f.createSubScope(a)},getScopeOwner:function(a,b){return f.getScopeOwner(a,b)},getElementNode:function(a){if(this.node){var b,c=this.node.childNodes,d=-1,e=this.node1,f=this.node2;f||(f=null);for(var g=e?!1:!0,h=0;c.length>h;h++)if(b=c[h],g){if(b===f)break;if(1===b.nodeType&&(d++,d===a))return b}else b===e&&(g=!0)}return null},getCptAttType:function(){return"CONTENT"},getCptContentType:function(a){if(a||(a=this.children),!a)return"INDEFINITE";for(var b,c=!1,d=!1,e=0,f=a.length;f>e;e++)if(b=a[e].getCptAttType(),"ATTELT"===b){if(c=!0,d)return"ERROR"}else if("CONTENT"===b){if(d=!0,c)return"ERROR"}else if("ERROR"===b)return"ERROR";return c?"ATTELT":d?"CONTENT":"INDEFINITE"}}),h=d({$constructor:function(a,b){this.name=a,this.value=b},getValue:function(){return this.value},getExprValues:function(){return[this.value]}}),i=d({$constructor:function(a,b){this.name=a,this.textcfg=b},getValue:function(a,b,c){var d=this.textcfg,e=d.length,f=[];if(2===e&&""===d[0])return a.getValue(d[1],b,c);for(var g=0;e>g;g++)f.push(g%2?a.getValue(d[g],b,c):d[g]);return f.join("")},getExprValues:function(a,b,c){for(var d=this.textcfg,e=[],f=0;f<d.length;f++)e.push(f%2?a.getValue(d[f],b,c):d[f]);return e}}),j=d({$constructor:function(a,b){this.evtType=a;var c="number"!=typeof b;c?(this.isHtmlCallback=!0,this.htmlCb=b):this.expIdx=b},executeCb:function(a,b,c){if(this.expIdx){var d=b.getExpr(this.expIdx);if(d)return d.executeCb(a,b,c)}}});a.exports.TNode=g,a.exports.TSimpleAtt=h,a.exports.TExpAtt=i}),a("hsp/rt/$text.js",["../klass","./document","./tnode"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("./document"),e=b("./tnode").TNode,f=b("./tnode").TExpAtt,g=c({$extends:e,$constructor:function(a,b){e.$constructor.call(this,a),this.textcfg=b,this.isEmptyTextNode=!1,this.isStatic&&(b?this.textcfg[0].match(/^\s*$/)&&(this.isEmptyTextNode=!0):(this.textcfg=[""],this.isEmptyTextNode=!0))},createNode:function(){this.node=d.createTextNode(this.getContent())},getContent:function(){var a=this.textcfg;return this.isStatic?a[0]:f.getValue.call(this,this.eh,this.vscope,"")},refresh:function(){this.adirty&&(this.node.nodeValue=this.getContent()),e.refresh.call(this)},getCptAttType:function(){return this.isEmptyTextNode?"INDEFINITE":"CONTENT"}});a.exports=g}),a("hsp/rt/cptwrapper.js",["../json","./log","../klass"],function(a){function b(a){return a}function c(a){var b=a.defaultValue,c=a.type;return void 0===b||"template"===c?j[c].defaultValue:j[c].convert(b,{type:"string"})}function d(a,b){var c,d,e,f=new l(a);if(b){var i=f.cpt,k=b.nodeInstance;if(k.isCptComponent||k.isCptAttElement){var m=b.attributes,n=b.content;if(f.nodeInstance=k,f.cpt.nodeInstance=k,m)for(var o in m)m.hasOwnProperty(o)&&(c=f.cpt.attributes[o],d=c.type,e=m[o],d&&j[d]&&(e=j[d].convert(e,c)),g.set(i,o,e));n&&(i.content?h.error(k+" Component controller cannot use 'content' for another property than child attribute elements"):g.set(i,"content",n))}}return f}var e=a.require,f=a.exports,g=(a.filename,a.dirname,e("../json")),h=e("./log"),i=e("../klass"),j={"int":{defaultValue:0,convert:function(a,b){var d=parseInt(a,10);return isNaN(d)?c(b):d}},"float":{defaultValue:0,convert:function(a,b){var d=parseFloat(a);return isNaN(d)?c(b):d}},"boolean":{defaultValue:!1,convert:function(a){return a===!0||1===a||"1"===a||"true"===a}},string:{defaultValue:"",convert:function(a){return a+""}},object:{defaultValue:null,convert:b},callback:{defaultValue:null,convert:b},template:{defaultValue:null,convert:b}},k={none:0,"1-way":1,"2-way":2},l=i({$constructor:function(a){if(a&&a.constructor===Function){this.cpt=new a,this.nodeInstance=null,this.root=null,this.initialized=!1,this.needsRefresh=!0;var b,c,d=this.cpt.attributes;if(d)for(var e in d)b=d[e],e.match(/^on/)?b.type?"callback"!==b.type&&(h.error("Attribute type 'callback' should be set to '"+e+"' instead of: "+b.type),b.type="callback"):h.error("Attribute type 'callback' should be set to '"+e+"'"):(c=b.binding,c?(c=k[c],void 0!==c?b._binding=c:(h.error("Invalid attribute binding value: "+b.binding),b._binding=0)):b._binding=0,b.type?"callback"===b.type?h.error("Attribute of type 'callback' must start with 'on' - please rename: "+e):void 0===j[b.type]&&(h.error("Invalid attribute type: "+b.type),b.type="string"):b.type="string")}else h.error("[CptWrapper] Invalid Component constructor!")},$dispose:function(){this._cptChgeCb&&(g.unobserve(this.cpt,this._cptChgeCb),this._cptChgeCb=null);var a=this.cpt;a&&(a.$dispose&&a.$dispose(),a.nodeInstance=null,this.cpt=null),this.nodeInstance=null,this.root=null},init:function(a,b){if(!this.initialized){this.initialized=!0;var c=this.cpt,d=c.attributes;if(c){if(c.$getElement=this.$getElement.bind(this),d){a||(a={});var e,f,i,k,l,m;for(var n in d)c[n]||(f=d[n],e=a[n],i="object"==typeof d[n],k=i&&d[n].type,k&&(m=j[f.type],m||(h.error("Invalid component attribute type: "+f.type),m=j.string)),"callback"!==f.type?("template"===f.type?l=null:(l="",void 0!==e?l=e:i?(l=f.defaultValue,void 0===l&&k&&(l=m.defaultValue)):l=f,k&&(l=m.convert(l,f))),c[n]=l):(this.createEventFunction(n.slice(2)),c[n].isEmpty=void 0===e))}c.$init&&c.$init(b),this._cptChgeCb=this.onCptChange.bind(this),g.observe(c,this._cptChgeCb)}}},createEventFunction:function(a){var b=this;this.cpt["on"+a]=function(c){c||(c={}),c.type||(c.type=a),b.nodeInstance&&b.nodeInstance.onEvent&&b.nodeInstance.onEvent(c)}},onCptChange:function(a){var b=a,c=this.cpt;if(a.constructor===Array){if(!(a.length>0))return void h.error("[CptNode] Invalid change - nbr of changes: "+a.length);b=a[0]}this.needsRefresh=!0;var d=b.name;if(""!==d){var e,f=!0,g=!1;if(c.attributes){if(e=c.attributes[d],g=void 0!==e){var i=e.type;if(i){var k=j[i].convert(b.newValue,e);b.newValue=k,c[d]=k}}g&&this.nodeInstance&&2===e._binding&&(b.newValue=this.cpt[d],this.nodeInstance.onAttributeChange(b)),g&&0===e._binding&&(f=!1)}if(f){if(this.processingChange===!0)return;this.processingChange=!0;try{var l="";g&&(l=e.onchange),l||(l=["on",d.charAt(0).toUpperCase(),d.slice(1),"Change"].join("")),c[l]&&c[l].call(c,b.newValue,b.oldValue)}finally{this.processingChange=!1}}}},$getElement:function(a){var b=this.nodeInstance;return b||(b=this.root),b?b.getElementNode(a):null},refresh:function(){var a=this.cpt;this.needsRefresh&&a&&a.$refresh&&(a.$refresh(),this.needsRefresh=!1)}});f.CptWrapper=l,f.createCptWrapper=d}),a("hsp/rt/cptcomponent.js",["../json","./log","./document","./$text","./cptwrapper"],function(a){var b,c,d,e=a.require,f=a.exports,g=(a.filename,a.dirname,e("../json")),h=e("./log"),i=e("./document"),j=e("./$text"),k=e("./cptwrapper");f.setDependency=function(a,e){"$CptAttElement"===a?c=e:"$CptNode"===a?b=e:"TNode"===a&&(d=e)},f.$CptComponent={initCpt:function(a){if(this.isCptComponent=!0,this.ctlConstuctor=a.ctlConstuctor,this.template)this.createPathObservers(),this.createCommentBoundaries("cpt"),this.createChildNodeInstances(),this.initChildComponents(),this.ctlWrapper.refresh();else if(a.cptattelement){var b=k.createCptWrapper(this.ctlConstuctor,this.getCptArguments());this.ctlWrapper=b,this.controller=b.cpt,b.cpt.tagName&&h.error(this+" 'tagName' is a reserved keyword and cannot be used in component controllers"),b.cpt.tagName=this.tagName}},getCptArguments:function(){this.template&&(this.ctlConstuctor=this.template.controllerConstructor);var a=this.ctlConstuctor.prototype;this.ctlAttributes=a.attributes,this.ctlElements=a.elements,this.loadCptAttElements();var b,c={nodeInstance:this,attributes:{},content:null},d=c.attributes;if(this.atts){var e,f=this.atts,g=this.eh,h=this.vscope;if(f)for(var i=0,j=this.atts.length;j>i;i++)b=f[i],e=b.name,"template"!==this.ctlAttributes[e].type&&(d[e]=b.getValue(g,h,null))}if(this.tplAttributes){var k=this.tplAttributes;for(var l in k)k.hasOwnProperty(l)&&(d[l]=k[l])}return this.childElements&&(c.content=this.getControllerContent()),c},createChildNodeInstances:function(){if(this.removeChildInstances(),this.template){this.vscope=this.parent.vscope;var a=this.getTemplateArguments(),b=this.getCptArguments(),c=this.node,d=i.createDocumentFragment();this.node=d,this.template.call(this,a,b),c.insertBefore(d,this.node2),this.replaceNodeBy(d,c),this.isDOMempty=!1}},$dispose:function(a){this.ctlWrapper&&(this.ctlWrapper.$dispose(),this.ctlWrapper=null,this.controller=null),this.ctlAttributes=null,this.cleanObjectProperties(a),this.ctlConstuctor=null;var b=this.tplAttributes;if(b)for(var c in b)b.hasOwnProperty(c)&&b[c].$dispose();var d=this._attGenerators;if(d)for(var c in d)d.hasOwnProperty(c)&&d[c].$dispose();var e=this.attEltNodes;if(e){for(var f=0,g=e.length;g>f;f++)e[f].$dispose();this.attEltNodes=null}},loadCptAttElements:function(){this.attEltNodes=null,this._attGenerators=null;var a={},b=this.ctlAttributes,d=null,e=null,f=0;for(var g in b)b.hasOwnProperty(g)&&"template"===b[g].type&&(a[g]=!0,f++,b[g].defaultContent&&(d=g),e=g);d||(1===f?d=e:f>1&&(h.error(this+" A default content element must be defined when multiple content elements are supported"),d=e)),this.manageDefaultAttElt(d);var i,k,l=this.atts;if(l)for(var g in l)if(l.hasOwnProperty(g)&&(i=l[g],k=i.name,a[k]))if(this.tplAttributes&&this.tplAttributes[k])h.error(this+" Component attribute '"+k+"' is defined multiple times - please check");else{if(!i.generator){var m;m=i.value?new j(0,[""+i.value]):new j(this.exps,l[g].textcfg),this._attGenerators||(this._attGenerators=[]),i.generator=new c(k,0,0,0,[m]),this._attGenerators.push(i.generator)}var n=i.generator.createNodeInstance(this);n.isCptContent=!0,this.attEltNodes||(this.attEltNodes=[]),this.attEltNodes.push(n)}this.retrieveAttElements()},manageDefaultAttElt:function(a){if(this.children){var b=this.getCptContentType(),d=!0;if("ERROR"===b)d=!1,h.error(this.info+" Component content cannot mix attribute elements with content elements");else if("ATTELT"!==b)if(a){var e=new c(a,0,0,0,this.children);this.children=[e]}else d=!1;
if(d){var f,g=this.children,i=g.length;this.attEltNodes||(this.attEltNodes=[]);for(var j=0;i>j;j++)g[j].isEmptyTextNode||(f=g[j].createNodeInstance(this),f.isCptContent=!0,this.attEltNodes.push(f))}}},retrieveAttElements:function(){var a=this.attEltNodes;if(!a)return null;for(var b=[],c=this.ctlAttributes,d=0,e=a.length;e>d;d++)a[d].registerAttElements(b);for(var f,g,i,j=[],k=this.ctlElements?this.ctlElements:[],d=0,e=b.length;e>d;d++)g=b[d],f=g.name,i=!0,c&&c[f]?(this.tplAttributes||(this.tplAttributes={}),this.tplAttributes[f]=g,i=!1):f?k[f]||(h.error(this+" Invalid attribute element: @"+f),i=!1):(h.error(this+" Invalid attribute element (unnamed)"),i=!1),i&&j.push(g);return 0===j.length&&(j=null),this.childElements=j,j},initChildComponents:function(){var a=this.childElements;if(a&&a.length)for(var b,c=0,d=a.length;d>c;c++)b=a[c].ctlWrapper,b&&!b.initialized&&b.init(null,this.controller)},getTplAttribute:function(a){var b=this.ctlAttributes;return b?b[a]:null},onEvent:function(a){var b=this.evtHandlers,c=a.type;if(b)for(var d=0,e=b.length;e>d;d++)if(b[d].evtType===c){b[d].executeCb(a,this.eh,this.parent.vscope);break}},replaceNodeBy:function(a,b){if(a!==b){d.replaceNodeBy.call(this,a,b);var c=this.attEltNodes;if(c)for(var e=0,f=c.length;f>e;e++)c[e].replaceNodeBy(a,b)}},getControllerContent:function(){var a,b=[],c=this.childElements,d=this.ctlElements;if(c&&c.length)for(var e=0,f=c.length;f>e;e++)a=d[c[e].name].type,"component"===a?b.push(c[e].controller):"template"===a?b.push(c[e]):h.error(this+" Invalid element type: "+a);return b.length>0?b:null},refresh:function(){if(this.edirty){var a=this.attEltNodes;if(a){for(var c=0,d=a.length;d>c;c++)a[c].refresh();this.retrieveAttElements(),this.initChildComponents()}g.set(this.controller,"content",this.getControllerContent()),this.edirty=!1}b.refresh.call(this),this.ctlWrapper&&this.ctlWrapper.refresh()},refreshAttributes:function(){var a,b,c,d=this.atts,e=this.eh,f=this.controller,h=this.isCptAttElement?this.vscope:this.parent.vscope;if(d&&f&&f.attributes)for(var i=0,j=this.atts.length;j>i;i++)a=d[i],b=f.attributes[a.name],"template"!==b.type&&0!==b._binding&&(c=a.getValue(e,h,null),"object"===b.type||"array"===b.type?g.set(f,a.name,c):""+c!=""+f[a.name]&&g.set(f,a.name,c))}}}),a("hsp/rt/cptattinsert.js",["./document"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("./document"));a.exports.$CptAttInsert={initCpt:function(a){this.createPathObservers(),this.createCommentBoundaries("cptattinsert"),this.createChildNodeInstances(a)},createChildNodeInstances:function(a){this.isDOMempty||(this.removeChildNodeInstances(this.node1,this.node2),this.isDOMempty=!0),this.cptAttElement=a,this.childNodes=[];var b=this.cptAttElement.getTemplateNode();if(b){this.childNodes[0]=b;var d=c.createDocumentFragment();b.render(d,!1),this.node.insertBefore(d,this.node2),b.replaceNodeBy(d,this.node),this.isDOMempty=!1}},$dispose:function(a){this.cptAllElt=null,this.cleanObjectProperties(a)}}}),a("hsp/rt/cpttemplate.js",["../json","./document"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../json")),d=b("./document");a.exports.$CptTemplate={initCpt:function(){this.createPathObservers(),this.createCommentBoundaries("template"),this.createChildNodeInstances(),this._scopeChgeCb=this.onScopeChange.bind(this),c.observe(this.vscope,this._scopeChgeCb)},createChildNodeInstances:function(){if(this.removeChildInstances(),this.template){var a=this.getTemplateArguments(),b=this.node,c=d.createDocumentFragment();this.node=c,this.template.call(this,a),b.insertBefore(c,this.node2),this.replaceNodeBy(c,b),this.isDOMempty=!1}},$dispose:function(a){this.cleanObjectProperties(a)},onScopeChange:function(a){a.constructor===Array&&a.length>0&&this.onAttributeChange(a[0])},refreshAttributes:function(){var a,b=this.atts,d=this.eh,e=this.parent.vscope;if(b)for(var f=this.vscope,g=0,h=this.atts.length;h>g;g++)a=b[g],c.set(f,a.name,a.getValue(d,e,null))}}}),a("hsp/rt/$root.js",["../klass","./log","./document","../json","../propobserver","./tnode","./cptcomponent","./cptattinsert","./cpttemplate"],function(a){var b=a.require,c=a.exports,d=(a.filename,a.dirname,b("../klass")),e=b("./log"),f=b("./document"),g=b("../json"),h=b("../propobserver"),i=b("./tnode"),j=i.TNode,k=b("./cptcomponent"),l={$CptAttInsert:b("./cptattinsert").$CptAttInsert,$CptComponent:k.$CptComponent,$CptTemplate:b("./cpttemplate").$CptTemplate},m=11,n=d({$extends:j,$constructor:function(a,b,c,e,g){if(this.isInsertNode)j.$constructor.call(this,this.exps);else{j.$constructor.call(this,0);var h=f.createDocumentFragment();this.node=h,this.root=this}this.MD_ID=d.createMetaDataPrefix()+"oid",this.propObs=[],this.argNames=null,(a||b||c||e)&&this.init(a,b,c,e,g)},init:function(a,b,c,d,e){var f;if(this.vscope=a,d)this.ctlWrapper=f=d,this.controller=d.cpt,this.ctlWrapper.root=this,this.ctlWrapper.init(e);else if(this.$constructor===p&&e)for(var g in e)a[g]=e[g];var h=[];if(b.constructor===Array)for(var i=0,j=b.length;j>i;i++)h.push(b[i].createNodeInstance(this));else h[0]=b.createNodeInstance(this);f&&!f.nodeInstance&&f.refresh(),this.childNodes=h,this.argNames=c},$dispose:function(){for(var a,b=0,c=this.propObs.length;c>b;b++)a=this.propObs[b],delete a.target[this.MD_ID],a.$dispose();this.propObs=null,this.ctlWrapper&&(this.ctlWrapper.$dispose(),this.ctlWrapper=null,this.controller=null),j.$dispose.call(this)},createExpressionObservers:function(a,b){var c,d,e=b?b:a.vscope,f=a.eh;if(f)for(var g in f.exps)if(c=f.exps[g].getObservablePairs(f,e))if(d=c.length,1===d)this.createObjectObserver(a,c[0][0],c[0][1]);else{a.obsPairs=c;for(var h=0;d>h;h++)this.createObjectObserver(a,c[h][0],c[h][1])}},createObjectObserver:function(a,b,c){var d,e=b[this.MD_ID];if(e)d=this.propObs[e-1];else{d=new h(b);var f=this.propObs.length;this.propObs[f]=d,d.id=e=f+1,b[this.MD_ID]=e}d.addObserver(a,c)},rmObjectObserver:function(a,b,c){var d=b[this.MD_ID];if(d){var e=this.propObs[d-1];e.rmObserver(a,c)}},rmAllObjectObservers:function(a){var b=a.obsPairs;if(b){for(var c=0,d=b.length;d>c;c++)this.rmObjectObserver(a,b[c][0],b[c][1]);a.obsPairs=null}},updateObjectObservers:function(a){a.obsPairs&&this.rmAllObjectObservers(a),this.createExpressionObservers(a)},updateArgument:function(a,b){g.set(this.vscope.scope,this.argNames[a],b)},render:function(a,b){var c=a;if("string"==typeof c){if(c=f.getElementById(c),null===c)return e.error("[hashspace] Template cannot be rendered - Invalid element id: "+a),this}else if(!c||!c.appendChild)return e.error("[hashspace] Template cannot be rendered - Invalid element: "+a),this;var d=this.node;return d.nodeType!==m?e.error("[hashspace] root element can only be appended once in the DOM"):(b!==!1&&(c.innerHTML=""),c.appendChild(d),this.replaceNodeBy(d,c)),this._triggersAfterRender(this),this},_triggersAfterRender:function(a){if(a.childNodes&&a.childNodes.length>0)for(var b=0;b<a.childNodes.length;b++)this._triggersAfterRender(a.childNodes[b]);a.controller&&a.controller.$afterRender&&a.controller.$afterRender()}}),o=c.getObject=function(a,b){var c=a[0],d=null,e=a.length;if(void 0===c||null===c||"string"==typeof c){if(b&&e>1&&(d=b[a[1]]),void 0===d||null===d)return null}else b&&e>1&&(d=b[a[1]]),d||(d=c);if(e>2)for(var f=2;e>f;f++)d=d[a[f]];return d},p=d({$extends:n,$constructor:function(a,b,c,d,e){this.pathInfo=a.slice(1).join("."),this.info="[Component: #"+this.pathInfo+"]",this.isCptNode=!0,this.attEltNodes=null,this.tplPath=a,this.isInsertNode=!0,this.isDOMless=!0,this.exps=b,this.attcfg=c,n.$constructor.call(this),this.createAttList(c,d),this.controller=null,this.ctlAttributes=null,this._scopeChgeCb=null,this.template=null,e&&0!==e&&(this.children=e)},$dispose:function(a){this.cleanObjectProperties(a)},cleanObjectProperties:function(a){this.removePathObservers(),this._scopeChgeCb&&(g.unobserve(this.vscope,this._scopeChgeCb),this._scopeChgeCb=null),a!==!0&&n.$dispose.call(this),this.exps=null,this.controller=null,this.ctlAttributes=null,this.template=null,this.node1&&(this.node1=null,this.node2=null)},createNodeInstance:function(a,b,c){var d=null,f=this.getPathData(this.tplPath,a.vscope),g=f.pathObject;return g&&(d=this.createCptInstance(f.cptType,a),d.node1=b,d.node2=c,"$CptAttInsert"===f.cptType?d.initCpt(g):(this.template=f.pathObject,d.initCpt({template:g,ctlConstuctor:g.controllerConstructor}))),d||(e.error(this.info+" Invalid component reference"),d=this.createCptInstance("$CptAttInsert",a)),d},getPathData:function(a,b){var c=o(a,b),d={cptType:"InvalidComponent"};return c&&(d.pathObject=c,"function"==typeof c?d.cptType=c.controllerConstructor?"$CptComponent":"$CptTemplate":c.isCptAttElement&&(d.cptType="$CptAttInsert")),d},removeChildInstances:function(){this.isDOMempty||(this.removeChildNodeInstances(this.node1,this.node2),this.isDOMempty=!0)},createCptInstance:function(a,b){var c=l[a],d=Object.create(this);for(var e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);this.cptType=a;var f=Object.create(d);return f.vscope=b.vscope,f.parent=b,f.nodeNS=b.nodeNS,f.root=b.root,f.root.createExpressionObservers(f),f.node=f.parent.node,f},createCommentBoundaries:function(a){if(!this.node1&&!this.node2){var b=this.node;this.node1=f.createComment("# "+a+" "+this.pathInfo),this.node2=f.createComment("# /"+a+" "+this.pathInfo),b.appendChild(this.node1),b.appendChild(this.node2)}},onAttributeChange:function(a){var b=-1,c=this.attcfg[a.name];if(c&&c.constructor===Array&&2===c.length&&""===c[0]&&(b=c[1]),b>-1){var d=this.eh.getExpr(b),e=this.parent.vscope;if(d.bound&&d.setValue){var f=d.getValue(e,this.eh);f!==a.newValue&&d.setValue(e,a.newValue)}}},reprocessNodeInstance:function(){var a=this.getPathData(this.tplPath,this.parent.vscope);if("InvalidComponent"===a.cptType||a.cptType===this.cptType)return null;var b=this.parent,c=this.createNodeInstance(b,this.node1,this.node2),d=b.childNodes;if(c&&d)for(var e=0,f=d.length;f>e;e++)if(d[e]===this)return d[e]=c,this.$dispose(!0),c;return null},refresh:function(){if(this.adirty){var a=this.reprocessNodeInstance();if(a)return void a.refresh();var b=!1;if(this.template){var c=o(this.tplPath,this.parent.vscope);b=c!==this.template}else if(this.cptAttElement){var d=o(this.tplPath,this.parent.vscope);d.isCptAttElement&&d!==this.cptAttElement&&this.createChildNodeInstances(d)}if(b)this.template=c,this.createChildNodeInstances();else if(this.refreshAttributes){this.refreshAttributes();var e=this.vscope;this.vscope=this.parent.vscope,this.root.updateObjectObservers(this),this.vscope=e}this.adirty=!1}j.refresh.call(this)},getPathObjects:function(){var a,b=this.tplPath,c=this.parent.vscope,d="string"==typeof b[0];if(c[b[1]]?a=this.getScopeOwner(b[1],c):(void 0===b[0]||null===b[0]||d)&&(d?(a=this.getScopeOwner(b[0],c),null===a&&(a=c)):a=c),a){var e=b.length,f=[];f.push(a);for(var g=1;e>g;g++){if(a=a[b[g]],void 0===a||null===a)return null;f.push(a)}return f}return null},createPathObservers:function(){var a=this.getPathObjects();if(!a||!a.length)return!1;var b=a.length;this._pathChgeCb=this.onPathChange.bind(this);for(var c=0;b>c;c++)g.observe(a[c],this._pathChgeCb);return this._observedPathObjects=a,!0},removePathObservers:function(){var a=this._observedPathObjects;if(a&&a.length){for(var b=0,c=a.length;c>b;b++)g.unobserve(a[b],this._pathChgeCb);this._observedPathObjects=null}this._pathChgeCb=null},onPathChange:function(){if(this.parent||this.root){var a=this.getPathObjects(),b=this._observedPathObjects,c=a?a.length:-1,d=b?b.length:-1,e=!1;if(c===d&&-1!==c){for(var f=0;c>f;f++)if(a[f]!==b[f]){e=!0;break}}else-1!==c&&(e=!0);e&&(this.removePathObservers(),this.createPathObservers(),this.onPropChange())}},getTemplateArguments:function(){var a={};if(this.atts)for(var b,c=this.parent.vscope,d=0,e=this.atts.length;e>d;d++)b=this.atts[d],a[b.name]=b.getValue(this.eh,c,null);return a}}),q=d({$extends:p,isCptAttElement:!0,$constructor:function(a,b,c,d,e){this.name=a,this.info="[Component attribute element: @"+this.name+"]",this.tagName="@"+a,p.$constructor.call(this,[null,a],b,c,d,e),this.isCptAttElement=!0},$dispose:function(){j.$dispose.call(this)},getCptAttType:function(){return"ATTELT"},createNodeInstance:function(a){for(var b,c=a,d=!1;c;)if(c.isCptComponent){d=!0;var f=null,g=null;if(c.ctlElements&&(f=c.ctlElements[this.name]),c.ctlAttributes&&(g=c.ctlAttributes[this.name]),f||g)if(f){var h=f.type;"template"===h?b=j.createNodeInstance.call(this,a):"component"===h?f.controller?(b=this.createCptInstance("$CptComponent",a),b.initCpt({cptattelement:b,ctlConstuctor:f.controller,parentCtrl:c.controller})):e.error(this.info+" Controller property is mandatory for component elements"):e.error(this.info+" Invalid component element type: "+f.type)}else g&&"template"===g.type&&(b=j.createNodeInstance.call(this,a));else e.error(this.info+" Element not supported by its parent component");c=null}else c=c.parent;return d||e.error(this.info+" Attribute elements cannot be used outside components"),b},registerAttElements:function(a){a.push(this)},getTemplateNode:function(){return new n(this.vscope,this.children)}});k.setDependency("$CptNode",p),k.setDependency("TNode",j),k.setDependency("$CptAttElement",q),c.$RootNode=n,c.$CptNode=p,c.$CptAttElement=q}),a("hsp/rt/colutils.js",["./log","../klass","../$set"],function(a){var b=a.require,c=a.exports,d=(a.filename,a.dirname,b("./log")),e=b("../klass"),f=b("../$set"),g=c.orderBy=function(a,b,c){var e,f,g=null,c=c===!0;if(a.constructor!==Array)return d.error("[orderBy()] array argument must be of type Array"),[];if(e=a.slice(0),b.constructor===Function)f=b;else{if(b.constructor!==String||""===b)return d.error("[orderBy()] Invalid expression argument: "+b),e;g=b}g&&(f=function(a,b){var c=a[g],d=b[g];return c=c?c:"",d=d?d:"",c>d?1:c==d?0:-1});var h=f;return c&&(h=function(a,b){return-1*f(a,b)}),e.sort(h)},h=c.Sorter=e({$constructor:function(a){var b=this.sortFunction=a.sortFunction,c=this.sortProperty=a.property;if(this.state="N",this.states=["N"],b){if(b.constructor!==Function)return d.error("[Sorter] Sort function must be a function: "+b)}else if(c&&c.constructor!==String)return d.error("[Sorter] Sort property must be a string: "+c);var e,f=a.states,g=[];f&&f.constructor!==String?(d.error("[Sorter] states option must be a string: "+f),f="NAD"):f=f?f.toUpperCase():"NAD";for(var h=0;f.length>h;h++)e=f.charAt(h),e.match(/[NAD]/)?g.push(e):d.error("[Sorter] Invalid state code: "+e);this.state=g[0],this.states=g},apply:function(a){if(a.constructor!==Array)return d.error("[Sorter.apply()] array argument must be of type Array"),[];if("N"===this.state)return a.slice(0);var b="D"===this.state,c=this.sortFunction?this.sortFunction:this.sortProperty;return g(a,c,b)},nextState:function(){for(var a=this.states,b=a[0],c=this.state,d=0;a.length-1>d;d++)if(a[d]===c){b=a[d+1];break}f(this,"state",b)},setState:function(a){for(var b=!1,c=this.states,e=0;c.length>e;e++)if(c[e]===a){b=!0;break}b?f(this,"state",a):d.error("[Sorter.setState] state argument '"+a+"' is not part of the possible states '"+this.states.join("")+"'")}});c.setGlobal=function(a){a.orderBy=g,a.Sorter=h}}),a("hsp/rt/$if.js",["../klass","./document","./tnode"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("./document"),e=b("./tnode"),f=e.TNode,g=c({$extends:f,$constructor:function(a,b,c,d){f.$constructor.call(this,a),this.isDOMless=!0,this.lastConditionValue=!1,this.isDOMempty=!0,this.condexpidx=b,c&&0!==c&&(this.children=c),d&&0!==d&&(this.children2=d)},createNodeInstance:function(a){var b=f.createNodeInstance.call(this,a),c=b.node;return b.TYPE="# if",b.node1=d.createComment("# if"),b.node2=d.createComment("# /if"),c.appendChild(b.node1),c.appendChild(b.node2),b.createChildNodeInstances(b.getConditionValue()),b},createChildNodeInstances:function(a){this.lastConditionValue=a,this.refScope||(this.refScope=this.vscope),this.isDOMempty||(this.removeChildNodeInstances(this.node1,this.node2),this.isDOMempty=!0),this.vscope=this.createSubScope(this.refScope);var b=a?this.children:this.children2;if(b){var c,e=b.length;if(e>0){this.childNodes=[];var f=d.createDocumentFragment();this.node=f;for(var g=0;e>g;g++)c=b[g].createNodeInstance(this),this.childNodes.push(c);this.replaceNodeBy(this.node,this.parent.node),this.node.insertBefore(f,this.node2),this.isDOMempty=!1}}},getConditionValue:function(){var a=!1;return this.eh&&(a=this.eh.getValue(this.condexpidx,this.vscope,!1)),a?!0:!1},refresh:function(){var a,b=this.getConditionValue();if(b!==this.lastConditionValue&&(this.createChildNodeInstances(b),this.root.updateObjectObservers(this),this.cdirty=!1,this.childNodes))for(var c=0;this.childNodes.length>c;c++)if(a=this.childNodes[c],a.adirty||a.cdirty){this.cdirty=!0;break}f.refresh.call(this)},getCptAttType:function(){var a=this.getCptContentType(this.children),b=this.getCptContentType(this.children2);return"ERROR"===a||"ERROR"===b?"ERROR":"ATTELT"===a?"CONTENT"===b?"ERROR":"ATTELT":"CONTENT"===a?"ATTELT"===b?"ERROR":"CONTENT":"INDEFINITE"===a?b:void 0},toString:function(){return"[If]"}});a.exports=g}),a("hsp/rt/$foreach.js",["../klass","./log","./document","../json","./tnode"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("./log"),e=b("./document"),f=b("../json"),g=b("./tnode"),h=g.TNode,i=c({$extends:h,$constructor:function(a,b,c,d,e,f){this.isDOMless=!0,this.itemName=c,this.itemKeyName=b,this.forType=0,this.colExpIdx=e,h.$constructor.call(this,a,!0),this.displayedCol=null,this.itemNode=new j(f,c,b)},$dispose:function(){h.$dispose.call(this),this.root&&this.displayedCol&&this.root.rmObjectObserver(this,this.displayedCol),this.displayedCol=null},createNodeInstance:function(a){var b=h.createNodeInstance.call(this,a);b.TYPE="# foreach";var c=b.node;b.node1=e.createComment("# foreach"),b.node2=e.createComment("# /foreach"),c.appendChild(b.node1);var d=b.eh.getValue(b.colExpIdx,b.vscope,null);return b.createChildNodeInstances(d,c),c.appendChild(b.node2),b},createChildNodeInstances:function(a,b){var c,e=this.forType,f=this.itemNode;if(a)if(this.displayedCol=a,this.childNodes=c=[],0===e&&a.constructor!==Array&&(e=1),0===e)for(var g=a.length,h=0,i=0;g>h;h++)null!=a[h]&&void 0!==a[h]&&(c.push(f.createNodeInstance(this,a[h],i,0===i,i===g-1,b)),i++);else d.warning("[# foreach] Invalid iteration type: "+e)},refresh:function(){if(this.adirty){var a=this.eh.getValue(this.colExpIdx,this.vscope,null);if(a!==this.displayedCol||null===this.childNodes||0===this.childNodes.length){this.root.rmObjectObserver(this,this.displayedCol),this.deleteAllItems();var b=e.createDocumentFragment();this.createChildNodeInstances(a,b),this.node.insertBefore(b,this.node2);for(var c=0,d=this.childNodes.length;d>c;c++)this.childNodes[c].replaceNodeBy(b,this.node)}else this.updateCollection(a)}h.refresh.call(this)},updateCollection:function(a){for(var b=[],c=this.itemName,d=this.childNodes.length,f=a.length,g=0;d>g;g++)b[g]=this.childNodes[g].vscope[c];for(var h,i,j,k=[],l=0,m=Math.max(d,f),g=0;d>g;g++)if(h=b[g],f>g)if(i=a[g],null!=i&&void 0!==i){if(h!==i)if(k[g]){this.childNodes.splice(g,0,k[g]),b.splice(g,0,k[g].vscope[c]),d+=1;var n=this.node2;d-1>g&&(n=this.childNodes[g+1].node1),k[g].attachDOMNodesBefore(n),k[g]=null}else if(j=a.indexOf(h,g),j>g?(k[j]=this.childNodes[g],this.childNodes[g].detachDOMNodes(l),this.childNodes.splice(g,1)):l=this.deleteItem(g,l,!1),b.splice(g,1),d-=1,j=b.indexOf(i,g),j>=g){if(j!=g){this.moveItem(j,g,l,!1);var o=b.splice(j,1);b.splice(g,0,o)}}else{var p=this.createItem(i,g,0===g,g===m-1,e.createDocumentFragment()),q=this.node2;this.childNodes[g+1]&&(q=this.childNodes[g+1].node1),this.node.insertBefore(p.node,q),p.replaceNodeBy(p.node,this.node),b.splice(g,0,i),d+=1}}else a.splice(g,1),k.splice(g,1),f-=1,m=Math.max(d,f),g-=1;else i=null,l=this.deleteItem(g,l,!1),b.splice(g,1),g-=1,d-=1;if(this.resyncItemScopes(0,f-1),f>d)for(var g=d;f>g;g++)if(i=a[g],null!=i&&void 0!==i)if(k[g])this.childNodes.splice(g,0,k[g]),k[g].attachDOMNodesBefore(this.node2),k[g].updateScope(g,0===g,g===m-1),k[g]=null;else{var p=this.createItem(i,g,0===g,g===m-1,e.createDocumentFragment());this.node.insertBefore(p.node,this.node2),p.replaceNodeBy(p.node,this.node)}else a.splice(g,1),k.splice(g,1),f-=1;k=null},deleteItem:function(a,b,c){var d=this.childNodes[a],e=0;return d&&(this.childNodes.splice(a,1),e=d.detachDOMNodes(b),d.$dispose(),c!==!1&&this.resyncItemScopes(a)),e},deleteAllItems:function(){if(this.node.childNodes)for(var a=this.node,b=!1,c=a.childNodes,d=c.length,e=this.node1,f=this.node2,g=0;d>g;g++){var h=c[g];if(h!==e){if(b){if(h===f)break;a.removeChild(h),g-=1,d-=1}}else b=!0}if(this.childNodes){for(var c=this.childNodes,g=0,d=c.length;d>g;g++)c[g].$dispose();this.childNodes=null}},moveItem:function(a,b,c,d){var e,f=this.childNodes,g=f.length;if(!(a===b||a>g-1||b>g-1)){var h=this.node2;g-1>b&&(h=f[b].node1),e=f[a],f.splice(a,1),e.detachDOMNodes(c),f.splice(b,0,e),e.attachDOMNodesBefore(h),d!==!1&&this.resyncItemScopes(Math.min(a,b))}},createItem:function(a,b,c,d,e){var f=this.itemNode.createNodeInstance(this,a,b,c,d,e);return this.childNodes.splice(b,0,f),f},resyncItemScopes:function(a,b){var c=this.childNodes.length;a||(a=0),void 0===b&&(b=c-1);for(var d=a;c>d;d++)this.childNodes[d].updateScope(d,0===d,d===b)},getCptAttType:function(){return this.itemNode.getCptAttType()},toString:function(){return"[Foreach]"}}),j=c({$extends:h,$constructor:function(a,b,c){h.$constructor.call(this,0),this.isDOMless=!0,this.itemName=b,this.itemKeyName=c,a&&0!==a&&(this.children=a),this.detachedNodes=null},$dispose:function(){h.$dispose.call(this),this.node1=null,this.node2=null,this.detachedNodes=null},createNodeInstance:function(a,b,c,d,f,g){var i=this.createSubScope(a.vscope),j=this.itemName;i[j]=b,i[this.itemKeyName]=c,i[j+"_isfirst"]=d,i[j+"_islast"]=f;var k=h.createNodeInstance.call(this,a);k.TYPE="# item";var l=k.node;if(k.vscope=i,k.node1=e.createComment("# item"),k.node2=e.createComment("# /item"),g&&(k.node=l=g),l.appendChild(k.node1),this.children){k.childNodes=[];for(var m=0,n=this.children.length;n>m;m++)k.childNodes[m]=this.children[m].createNodeInstance(k)}return l.appendChild(k.node2),k},detachDOMNodes:function(a){a||(a=0);var b=a;if(!this.node.childNodes)return b;var b,c,d=this.node,e=!1,f=d.childNodes.length,g=this.node1,h=this.node2;if(!this.detachedNodes){this.detachedNodes=[];for(var i=a;f>i;i++)if(c=d.childNodes[i],c===g&&(e=!0),e&&(this.detachedNodes.push(c),d.removeChild(c),i-=1,c===h)){b=i;break}return b}},attachDOMNodesBefore:function(a){if(this.detachedNodes){var b=this.detachedNodes,c=b.length;if(!a||!this.detachedNodes)return;for(var d=e.createDocumentFragment(),f=0;c>f;f++)d.appendChild(b[f]);a.parentNode.insertBefore(d,a)}this.detachedNodes=null},updateScope:function(a,b,c){var d=this.vscope,e=this.itemName;f.set(d,this.itemKeyName,a),f.set(d,e+"_isfirst",b),f.set(d,e+"_islast",c)},getCptAttType:function(){return this.getCptContentType()},toString:function(){return"[Foreach item]"}});a.exports=i}),a("hsp/rt/browser.js",[],function(a){function b(){return!!window.document.createElementNS&&!!window.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}a.require,a.exports,a.filename,a.dirname;a.exports.supportsSvg=b}),a("hsp/rt/attributes/class.js",["../../klass"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../../klass")),d=c({$constructor:function(a){this.nodeInstance=a,this.previousClasses=null},$setValueFromExp:function(a,b){for(var c,d,e=[],f=0;f<b.length;f++)if(b%2||"object"!=typeof b[f])e.push(b[f]);else{d=b[f];for(var g in d)d.hasOwnProperty(g)&&d[g]&&e.push(g)}c=e.join(" ");var h=this.nodeInstance.node.className,i=h&&h.split?h.split(" "):[];if(this.previousClasses)for(var j=this.previousClasses.split(" "),f=0;f<j.length;f++){var k=i.indexOf(j[f]);k>-1&&i.splice(k,1)}null!=c&&c.length>0&&i.splice(0,0,c.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")),this.previousClasses=c,this.nodeInstance.nodeNS?this.nodeInstance.node.setAttribute("class",i.join(" ")):this.nodeInstance.node.className=i.join(" ")},$dispose:function(){this.previousClasses=null}});a.exports=d}),a("hsp/rt/attributes/modelvalue.js",["../../klass"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../../klass")),d=c({$constructor:function(a){this.nodeInstance=a,this.node=a.node,this._lastValues={},this._inputEvents=["click","focus","input","keyup","change"],a.addEventListeners(this._inputEvents)},$setValue:function(a,b){"value"===a&&"radio"===this.node.type&&(this.node.value=b),this._lastValues[a]=b},$onAttributesRefresh:function(){var a="undefined"==typeof this._lastValues.model?this._lastValues.value:this._lastValues.model,b=""+a;if("radio"===this.node.type){var c=""+this.node.value;this.node.checked=b===c}else if("checkbox"===this.node.type){var c=""+this.node.checked;b!==c&&(this.node.checked=!this.node.checked)}else b!=this.node.value&&(this.node.value=a)},$handleEvent:function(a){if(this._inputEvents.indexOf(a.type)>-1){var b=this.node.value,c=this.node.type;"checkbox"===c&&(b=this.node.checked);var d=this.nodeInstance.setAttributeValueInModel("model",b);d||this.nodeInstance.setAttributeValueInModel("value",b)}},$dispose:function(){this._inputEvents.length=0}});a.exports=d}),a("hsp/rt/attributes/onupdate.js",["../../klass"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../../klass")),d=c({ONUPDATE_TIMER:500,$constructor:function(a,b){this.callback=b,this._inputEvents=["input","keyup","change"],a.addEventListeners(this._inputEvents),this.timerValue=this.ONUPDATE_TIMER,this.timerId=null,this.nodeInstance=a},$setValue:function(a,b){if("update-timeout"===a){var c=parseInt(b);isNaN(c)||(this.timerValue=c)}},$handleEvent:function(a){if(this._inputEvents.indexOf(a.type)>-1){this._clearTimer();var b=this;this.timerId=setTimeout(function(){b._onUpdateFinalize(a)},this.timerValue)}},_onUpdateFinalize:function(a){var b={};for(var c in a)b[c]=a[c];b.type="update",b.target=this.nodeInstance.node,this.callback(b)},_clearTimer:function(){this.timerId&&(clearTimeout(this.timerId),this.timerId=null)},$dispose:function(){this._clearTimer()}});a.exports=d}),a("hsp/rt/eltnode.js",["../klass","./browser","./document","./tnode","../rt","./log","./attributes/class","./attributes/modelvalue","./attributes/onupdate"],function(a){function b(a){return m.hasOwnProperty(a)}var c=a.require,d=(a.exports,a.filename,a.dirname,c("../klass")),e=c("./browser"),f=c("./document"),g=c("./tnode").TNode,h=c("../rt"),i=c("./log"),j=c("./attributes/class");h.registerCustomAttributes("class",j);var k=c("./attributes/modelvalue");h.registerCustomAttributes(["model","value"],k,0,["input","textarea"]);var l=c("./attributes/onupdate");h.registerCustomAttributes(["onupdate","update-timeout"],l,0,["input","textarea"]);var m={async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,open:!0,readonly:!0,required:!0,scoped:!0,selected:!0},n=d({$extends:g,$constructor:function(a,b,c,d,e,f){g.$constructor.call(this,b),this.tag=a,this.createAttList(c,d),e&&0!==e&&(this.children=e),this.needSubScope=1===f},$dispose:function(){var a=this.node;if(this._allEvtLsnr)for(var b=void 0!==a.removeEventListener,c=0;c<this._allEvtLsnr.length;c++)b?a.removeEventListener(this._allEvtLsnr[c],this,!1):a.detachEvent("on"+this._allEvtLsnr[c],this._attachEventFn);if(this._allEvtLsnr.length=0,this._custAttrHandlers){for(var d in this._custAttrHandlers)for(var e=this._custAttrHandlers[d],c=0;c<e.length;c++)e[c].instance.$dispose&&e[c].instance.$dispose();this._custAttrHandlers=null,this._custAttrData=null,this._allCustAttrHandlers.length=0}this._attachEventFn=null,g.$dispose.call(this)},createNodeInstance:function(a){var b=g.createNodeInstance.call(this,a);if(b._allCustAttrHandlers)for(var c=0;c<b._allCustAttrHandlers.length;c++){var d=b._allCustAttrHandlers[c].instance;d.$onContentRefresh&&d.$onContentRefresh()}return b},createNode:function(){this.TYPE=this.tag;var a,b,c=null,d=null,g=this.evtHandlers;if(this._custAttrHandlers={},this._allCustAttrHandlers=[],this._custAttrData={},this._allEvtLsnr=[],g)for(var j=0;j<g.length;j++)this._allEvtLsnr.push(g[j].evtType);if("svg"===this.tag&&(e.supportsSvg()?this.nodeNS="http://www.w3.org/2000/svg":i.error("This browser does not support SVG elements")),this.nodeNS)a=f.createElementNS(this.nodeNS,this.tag);else if(this.atts&&this.atts.length>0){a=f.createElement(this.tag);for(var j=0;j<this.atts.length;j++)"type"===this.atts[j].name&&(c=this.atts[j].value),"name"===this.atts[j].name&&(d=this.atts[j].value);if(c||d)try{c&&(a.type=c),d&&(a.name=d)}catch(k){b=f.createElement("div"),b.innerHTML="<"+this.tag+(c?" type="+c:"")+(d?" name="+d:"")+" >",a=b.children[0]}}else a=f.createElement(this.tag);this.node=a;var l=void 0!==a.addEventListener;if(!l){var m=this;this._attachEventFn=function(a){m.handleEvent(a)}}if(this.refreshAttributes(!0),g)for(var j=0;j<g.length;j++){var n=g[j],o="on"+n.evtType,p=h.getCustomAttributeHandlers(o,this.tag);if(p&&p.length>0)for(var q=0;q<p.length;q++){var r=this._createCustomAttributeHandler(o,p[q]).instance;r.$setValue&&r.$setValue(o,o)}else this._allEvtLsnr.push(n.evtType),l?a.addEventListener(n.evtType,this,!1):a.attachEvent("on"+n.evtType,this._attachEventFn)}},handleEvent:function(a){for(var b=0;b<this._allCustAttrHandlers.length;b++){var c=this._allCustAttrHandlers[b].instance;c.$handleEvent&&c.$handleEvent(a)}var d=this.evtHandlers,e=null;if(d)for(var b=0;b<d.length;b++)if(d[b].evtType===a.type){e=d[b].executeCb(a,this.eh,this.vscope);break}return e===!1&&a.preventDefault(),e},refresh:function(){var a=this.cdirty;if(this.adirty&&this.refreshAttributes(),g.refresh.call(this),a&&this._allCustAttrHandlers)for(var b=0;b<this._allCustAttrHandlers.length;b++){var c=this._allCustAttrHandlers[b].instance;c.$onContentRefresh&&c.$onContentRefresh()}},_createCustomAttributeHandler:function(a,b){var c=null;"undefined"==typeof this._custAttrHandlers[a]&&(this._custAttrHandlers[a]=[]);var d=!1;if(this._custAttrHandlers[a])for(var e=0;e<this._custAttrHandlers[a].length;e++)if(b.handler==this._custAttrHandlers[a][e].klass){c=this._custAttrHandlers[a][e],d=!0;break}if(!d){c={klass:b.handler,instance:new b.handler(this,this.handleEvent.bind(this))};for(var f=0;f<b.names.length;f++)"undefined"==typeof this._custAttrHandlers[b.names[f]]&&(this._custAttrHandlers[b.names[f]]=[]),this._custAttrHandlers[b.names[f]].push(c);this._allCustAttrHandlers.push(c)}return c},refreshAttributes:function(a){var c,d,e=this.node,f=this.atts,g=this.eh,i=this.vscope;if(f)for(var j=0;j<f.length;j++){if(c=f[j],d=c.name,a){var k=h.getCustomAttributeHandlers(d,this.tag);if(k&&k.length>0){for(var l=0;l<k.length;l++)this._createCustomAttributeHandler(d,k[l]);this._custAttrData[d]={},c.textcfg&&2===c.textcfg.length&&""===c.textcfg[0]&&(this._custAttrData[d].exprIndex=c.textcfg[1])}}var k=this._custAttrHandlers[d];if(k){for(var m=c.getValue(g,i,null),n=this._custAttrData[d].value!==m,o=c.getExprValues(g,i,null),l=0;k&&l<k.length;l++){var p=k[l].instance;p.$setValueFromExp?p.$setValueFromExp(d,o):p.$setValue&&n&&p.$setValue(d,m)}this._custAttrData[d].value=m}else if(b(d))e[d]=c.getValue(g,i,"");else try{e.setAttribute(c.name,c.getValue(g,i,null))}catch(q){}}if(this.htmlCbs)for(var r,j=0;j<this.htmlCbs.length;j++)r=this.htmlCbs[j],e.setAttribute("on"+r.evtType,r.htmlCb);for(var j=0;j<this._allCustAttrHandlers.length;j++){var s=this._allCustAttrHandlers[j].instance;s.$onAttributesRefresh&&s.$onAttributesRefresh()}},setAttributeValueInModel:function(a,b){if(this._custAttrData[a]){var c=this._custAttrData[a].exprIndex;if(this.eh&&"undefined"!=typeof c){var d=this.eh.getExpr(c);if(d.setValue&&this._custAttrData[a].value!==b){var e=d.getValue(this.vscope,this.eh);if(b!==e)return d.setValue(this.vscope,b),h.refresh(),!0}}}return!1},addEventListeners:function(a){for(var b=void 0!==this.node.addEventListener,c=0;c<a.length;c++){var d=a[c];-1===this._allEvtLsnr.indexOf(d)&&(this._allEvtLsnr.push(d),b?this.node.addEventListener(d,this,!1):this.node.attachEvent("on"+d,this._attachEventFn))
}},getAncestorByCustomAttribute:function(a){for(var b=this.parent;b&&!b._custAttrHandlers[a];)b=b.parent;return b},getCustomAttributeHandlers:function(a){for(var b=[],c=this._custAttrHandlers[a],d=0;d<c.length;d++)b.push(c[d].instance);return b}});a.exports=n}),a("hsp/rt/$log.js",["../klass","./log","./document","./tnode"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("./log"),e=b("./document"),f=b("./tnode").TNode,g=c({$extends:f,$constructor:function(a,b,c,d,e){f.$constructor.call(this,a),this.file="";var g=b.match(/[^\/\\]+$/);g&&g.length&&(this.file=g[0]),this.dir=c,this.line=d,this.column=e},createNode:function(){this.node=e.createComment("{log}"),this.processLog()},processLog:function(){var a=this.eh.getExpr(1),b=a.getValue(this.vscope,void 0),c=a.isMultiStatement?b:[b];c.push({type:"debug",file:this.file,dir:this.dir,line:this.line,column:this.column}),d.apply(null,c)},refresh:function(){this.adirty&&this.processLog(),f.refresh.call(this)},getCptAttType:function(){return"CONTENT"}});a.exports=g}),a("hsp/rt/$let.js",["../klass","../$set","./document","./tnode","../expressions/manipulator"],function(a){var b=a.require,c=(a.exports,a.filename,a.dirname,b("../klass")),d=b("../$set"),e=b("./document"),f=b("./tnode").TNode,g=b("../expressions/manipulator"),h=c({$extends:f,$constructor:function(a){f.$constructor.call(this,a);var b=this.eh.getExpr(1),c=b.isMultiStatement?b.ast:[b.ast];this.expTrees=[];for(var d=0;d<c.length;d++)this.expTrees.push([c[d].l.v,g(a[0],c[d].r)])},createNode:function(){this.node=e.createComment("{let}"),this.updateScope()},onPropChange:function(a){this.updateScope(),f.onPropChange.call(this,a)},updateScope:function(){for(var a=this.expTrees,b=0;b<a.length;b++)d(this.vscope,a[b][0],a[b][1].getValue(this.vscope,void 0))}});a.exports=h}),a("hsp/rt.js",["./es5","./klass","./rt/log","./rt/$root","./rt/cptwrapper","./rt/colutils","./rt/$text","./rt/$if","./rt/$foreach","./rt/eltnode","./rt/$log","./rt/$let"],function(a,b){function c(a){var c=b[a];return void 0===c&&(c=null),c}function d(a,b){return b.priority-a.priority}function e(a,b){v[a]=function(a,c,d,e,f,g){return new b(a,c,d,e,f,g)}}{var f=a.require,g=a.exports;a.filename,a.dirname}f("./es5");var h=f("./klass"),i=f("./rt/log"),j=f("./rt/$root"),k=j.$RootNode,l=j.$CptNode,m=j.$CptAttElement,n=f("./rt/cptwrapper"),o=f("./rt/colutils"),p=h({$constructor:function(a){this.nodedefs=a},process:function(a,b,c,d,e){var f,g=e?Object.create(e):{},h=[];if(b)for(var i=0,j=b.length;j>i;i+=2)f=b[i],g[f]=b[i+1],h.push(f);g.scope=g;var m=null;return a.$constructor&&a.$constructor===l?(m=a,m.init(g,this.nodedefs,h,c,d)):m=new k(g,this.nodedefs,h,c,d),m}}),q=[],r=null,s=g.refresh=function(){var a;for(r&&(clearTimeout(r),r=null);a=q.shift();)a.refresh()},t=function(){r=null,s()},b=g.global={};o.setGlobal(b),s.addTemplate=function(a){var b=q.indexOf(a);0>b&&(q.push(a),r||(r=setTimeout(t,0)))},g.template=function(a,b){var c,d=new p(null),e=[],f=0,g=!1,h=null;if(a.constructor===Array){f=a.length;for(var k=0;f>k;k++)e.push(a[k]),e.push(null)}else{g=!0,h=j.getObject(a.ctl);var l=null;if(null===h?l="Undefined component controller: "+a.ctl.slice(1).join("."):h.constructor!==Function&&(l="Component controller must be a function: "+a.ctl.slice(1).join(".")),l)throw i.error(l),l;e[0]=a.ref}var m=function(){var a=null,i=null;if(!d.nodedefs)try{var j=b(v);c=j.shift(),d.nodedefs=j}catch(k){throw k.constructor===ReferenceError?"Invalid reference: "+(k.message||k.description):k}if(g)a=n.createCptWrapper(h,arguments.length>1?arguments[1]:null),e[1]=a.cpt;else for(var l=0;f>l;l++)e[1+2*l]=arguments[l];return arguments.length>0&&(i=arguments[0]),d.process(this,e,a,i,c)};return m.isTemplate=!0,m.controllerConstructor=h,m};var u=[];g.registerCustomAttributes=function(a,b,c,d){var e=a;if(a.constructor!==Array&&(e=[a]),e&&e.length>0&&b){var f=c||0,g={names:e,handler:b,priority:f,tags:d};u.push(g)}},g.getCustomAttributeHandlers=function(a,b){for(var c=[],e=0;e<u.length;e++){var f=u[e];f.names.indexOf(a)>-1&&("undefined"==typeof f.tags||f.tags.indexOf(b)>-1)&&c.push(f)}return c.sort(d)};for(var v={},w=["$text",f("./rt/$text"),"$if",f("./rt/$if"),"$foreach",f("./rt/$foreach"),"elt",f("./rt/eltnode"),"cpt",l,"catt",m,"log",f("./rt/$log"),"let",f("./rt/$let")],x=0,y=w.length;y>x;x+=2)e(w[x],w[x+1]);v.g=c})}(noder.define);